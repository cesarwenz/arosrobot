<?xml version="1.0"?>
<launch>
  <arg name="model" default="$(find icerobot_description)/urdf/icerobot.urdf.xacro"/>
  <param name="robot_description" command="$(find xacro)/xacro $(arg model)" />


  <!-- Load controller configuration -->
  <rosparam command="load" file="$(find icerobot_teleop)/config/control.yaml" />

  <!-- Spawn controllers -->
  <node name="base_controller_spawner" pkg="controller_manager" type="spawner"
        args="icerobot_joint_publisher icerobot_velocity_controller"/>


  <!-- Start EKF for localization 
  <node pkg="robot_localization" type="ekf_localization_node" name="ekf_localization">
    <rosparam command="load" file="$(find icerobot_teleop)/config/localization.yaml" />
  </node>
-->

  <rosparam command="load" file="$(find icerobot_teleop)/config/navsat_localization.yaml" />

  <node pkg="robot_localization" type="ekf_localization_node" name="ekf_se_odom" clear_params="true"/>

  <node pkg="robot_localization" type="ekf_localization_node" name="ekf_se_map" clear_params="true">
    <remap from="odometry/filtered" to="odometry/filtered_map"/>
  </node>

  <node pkg="robot_localization" type="navsat_transform_node" name="navsat_transform" clear_params="true">
    <remap from="odometry/filtered" to="odometry/filtered_map"/>
    <remap from="gps/fix" to="navsat/fix"/>
    <remap from="imu/data" to="imu/data"/>1
  </node>

  <node pkg="icerobot_teleop" type="icerobot_teleop_key" name="icerobot_teleop_keyboard"  output="screen">
  </node>

  <node pkg="twist_mux" type="twist_mux" name="twist_mux">
    <rosparam command="load" file="$(find icerobot_teleop)/config/twist_mux.yaml" />
    <remap from="cmd_vel_out" to="icerobot_velocity_controller/cmd_vel"/>
  </node>

  <node pkg="interactive_marker_twist_server" type="marker_server" name="twist_marker_server" output="screen"/>

</launch>
